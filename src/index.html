<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fairy Tale | Temukan Ceritamu</title>

    <!-- Leaflet -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      defer
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>
  <body>
    <a href="#main-content" class="skip-link">Skip to content</a>

    <header class="header">
      <div class="container">
        <div class="header-content">
          <h1 class="site-title">Fairy Tale</h1>
          <nav class="nav">
            <ul class="nav-list" id="nav-menu"></ul>
          </nav>

          <script>
            function updateAuthUI() {
              const navMenu = document.getElementById("nav-menu");

              if (window.AuthService && window.AuthService.isLoggedIn()) {
                navMenu.innerHTML = `
                  <li><a href="#/" class="nav-link">Home</a></li>
                  <li><a href="#/add" class="nav-link">Add Story</a></li>
                  <li><a href="#/stories" class="nav-link">Stories</a></li>
                  <li>
                    <a href="#" class="nav-link" id="logout-link">Logout</a>
                  </li>
                `;

                document
                  .getElementById("logout-link")
                  .addEventListener("click", (e) => {
                    e.preventDefault();
                    window.AuthService.logout();
                    window.location.hash = "#/";
                    // Update UI after logout
                    updateAuthUI();
                  });
              } else {
                // User is not logged in - only show register and login options
                navMenu.innerHTML = `
                  <li><a href="#/register" class="nav-link">Register</a></li>
                  <li><a href="#/login" class="nav-link">Login</a></li>
                `;
              }
            }

            // Call this when the app initializes and after login/logout
            document.addEventListener("DOMContentLoaded", () => {
              setTimeout(() => {
                if (window.AuthService) {
                  console.log(
                    "Auth check on load:",
                    window.AuthService.isLoggedIn()
                  );
                  updateAuthUI();
                } else {
                  console.error("AuthService not available on window object");
                }
              }, 100); // Small delay to ensure AuthService is loaded
            });
          </script>
        </div>
      </div>
    </header>

    <main id="main-content" class="main-content"></main>

    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div>
            <h2 class="footer-title">Fairy Tale</h2>
            <p class="footer-description">
              Web-based SPA for sharing your stories with map integration
            </p>
          </div>
          <p class="footer-copy">
            &copy; 2025 Fairy Tale | Reyhan Al Farel. All rights reserved.
          </p>
        </div>
      </div>
    </footer>
  </body>
</html>
